\section{Virtual Machine Invocations}\label{sec:virtualmachineinvocations}

We now define the four practical instances where we wish to invoke a PVM instance as part of the protocol. In general we avoid introducing unbounded data as part of the basic invocation arguments in order to minimise the chance of an unexpectedly large RAM allocation, which could lead to gas inflation and unavoidable underflow. This makes for a more cumbersome interface, but one which is more predictable and easier to reason about.


\subsection{Host-Call Result Constants}

\begin{description}
  \item[$\mathtt{NONE} = 2^{64} - 1$] The return value indicating an item does not exist.
  \item[$\mathtt{WHAT} = 2^{64} - 2$] Name unknown.
  \item[$\mathtt{OOB} = 2^{64} - 3$] The inner \textsc{pvm} memory index provided for reading/writing is not accessible.
  \item[$\mathtt{WHO} = 2^{64} - 4$] Index unknown.
  \item[$\mathtt{FULL} = 2^{64} - 5$] Storage full.
  \item[$\mathtt{CORE} = 2^{64} - 6$] Core index unknown.
  \item[$\mathtt{CASH} = 2^{64} - 7$] Insufficient funds.
  \item[$\mathtt{LOW} = 2^{64} - 8$] Gas limit too low.
  \item[$\mathtt{HUH} = 2^{64} - 9$] The item is already solicited or cannot be forgotten.
  \item[$\mathtt{OK} = 0$] The return value indicating general success.
\end{description}

Inner \textsc{pvm} invocations have their own set of result codes:
\begin{description}
  \item[$\mathtt{HALT} = 0$] The invocation completed and halted normally.
  \item[$\mathtt{PANIC} = 1$] The invocation completed with a panic.
  \item[$\mathtt{FAULT} = 2$] The invocation completed with a page fault.
  \item[$\mathtt{HOST} = 3$] The invocation completed with a host-call fault.
  \item[$\mathtt{OOG} = 4$] The invocation completed by running out of gas.
\end{description}

Note return codes for a host-call-request exit are any non-zero value less than $2^{64} - 13$.

\subsection{Is-Authorized Invocation}\label{sec:isauthorizedinvocation}

The Is-Authorized invocation is the first and simplest of the four, being totally stateless. It provides only host-call functions for inspecting its environment and parameters. It accepts as arguments only the core on which it should be executed, $c$. Formally, it is defined as $\Psi_I$:
\begin{align}
  \label{eq:isauthinvocation}
  \Psi_I &\colon \abracegroup{
    \tuple{\workpackage, \coreindex} &\to \tuple{\blob \cup \workerror, \gas} \\
    \tup{\wpX, c} &\mapsto \begin{cases}
      \tup{\token{BAD}, 0} &\when \wpX_\wp¬authcode = \none \\
      \tup{\token{BIG}, 0} &\otherwhen \len{\wpX_\wp¬authcode} > \Cmaxauthcodesize \\
      \tup{\mathbf{r}, u} &\otherwise \\
      \multicolumn{2}{l}{\where \tup{u, \mathbf{r}, \none} = \Psi_M(\wpX_\wp¬authcode, 0, \Cpackageauthgas, \encode[2]{c}, F, \none)}\\
    \end{cases}\\
  } \\
  \label{eq:isauthorizedmutator}F \in \contextmutator{\emset} &\colon
    \tup{n, \gascounter, \registers, \memory} \mapsto \begin{cases}
      \Omega_G(\gascounter, \registers, \memory) &\when n = \mathtt{gas} \\
      \Omega_Y(\gascounter, \registers, \memory, \wpX, \none, \none, \none, \none, \none, \none, \none) &\when n = \mathtt{fetch} \\
      \tup{\continue, \gascounter - 10, \sq{\registers_0, \dots, \registers_6, \mathtt{WHAT}, \registers_8, \dots}, \memory} &\otherwise
    \end{cases}
\end{align}

Note for the Is-Authorized host-call dispatch function $F$ in equation \ref{eq:isauthorizedmutator}, we elide the host-call context since, being essentially stateless, it is always $\none$.

\subsection{Refine Invocation}\label{sec:refineinvocation}

We define the Refine service-account invocation function as $\Psi_R$. It has no general access to the state of the \Jam chain, with the slight exception being the ability to make a historical lookup. Beyond this it is able to create inner instances of the \textsc{pvm} and dictate pieces of data to export.

The historical-lookup host-call function, $\Omega_H$, is designed to give the same result regardless of the state of the chain for any time when auditing may occur (which we bound to be less than two epochs from being accumulated). The lookup anchor may be up to $\Cmaxlookupanchorage$ timeslots before the recent history and therefore adds to the potential age at the time of audit. We therefore set $\Cexpungeperiod$ to have a safety margin of eight hours:
\begin{equation}
  \Cexpungeperiod \equiv \Cmaxlookupanchorage + 4,800 = 19,200
\end{equation}


The inner \textsc{pvm} invocation host-calls, meanwhile, depend on an integrated \textsc{pvm} type, which we shall denote $\pvmguest$. It holds some program code, instruction counter and \textsc{ram}:
\begin{equation}\label{eq:pvmguest}
  \pvmguest \equiv \tuple{\isa{\pg¬code}{\blob}, \isa{\pg¬ram}{\ram}, \isa{\pg¬pc}{\pvmreg}}
\end{equation}

The Export host-call depends on two pieces of context; one sequence of segments (blobs of length $\Csegmentsize$) to which it may append, and the other an argument passed to the invocation function to dictate the number of segments prior which may assumed to have already been appended. The latter value ensures that an accurate segment index can be provided to the caller.

Unlike the other invocation functions, the Refine invocation function implicitly draws upon some recent service account state item $\accounts$. The specific block from which this comes is not important, as long as it is no earlier than its work-package's lookup-anchor block. It explicitly accepts the work-package $p$ and the index of the work item to be refined, $i$. Additionally, the authorizer trace $\mathbf{r}$ is provided together with all work items' import segments $\overline{\mathbf{i}}$ and an export segment offset $\segoff$. It results in either some error $\workerror$ or a pair of the refinement output blob and the export sequence. Formally:
\begin{align}
  &\Psi_R \colon \abracegroup{
    \label{eq:refinvocation}
    \tuple{\N, \workpackage, \blob, \sequence{\sequence{\segment}}, \N} &\to \tuple{\blob \cup \workerror, \sequence{\segment}, \gas} \\
    \tup{i, p, \mathbf{r}, \overline{\mathbf{i}}, \segoff} &\mapsto \begin{cases}
      \tup{\token{BAD}, \sq{}, 0} &\when w_\wi¬serviceindex \not\in \keys{\accounts} \vee \histlookup(\accounts\subb{w_\wi¬serviceindex}, (p_\wp¬context)_\wc¬lookupanchortime, w_\wi¬codehash) = \none \\
      \tup{\token{BIG}, \sq{}, 0} &\otherwhen \len{\histlookup(\accounts\subb{w_\wi¬serviceindex}, (p_\wp¬context)_\wc¬lookupanchortime, w_\wi¬codehash)} > \Cmaxservicecodesize \\
      &\otherwise: \\
      &\quad\using a = \encode{i, w_\wi¬serviceindex, \var{w_\wi¬payload}, \blake{p}}\;,\ \encode{\var{\mathbf{z}}, \mathbf{c}} = \histlookup(\accounts\subb{w_\wi¬serviceindex}, (p_\wp¬context)_\wc¬lookupanchortime, w_\wi¬codehash)\\
      &\quad\also \tup{u, \mathbf{o}, \tup{\mathbf{m}, \mathbf{e}}} = \Psi_M(\mathbf{c}, 0, w_\wi¬refgaslimit, a, F, \tup{\emptyset, \sq{}})\ \colon\\
      \tup{\mathbf{o}, \sq{}, u} &\quad\when \mathbf{o} \in \set{ \oog, \panic }  \\
      \tup{\mathbf{o}, \mathbf{e}, u} &\quad\otherwise \\
      \multicolumn{2}{l}{\where w = p_\wp¬workitems\subb{i}}
    \end{cases} \\
  } \\
  \label{eq:refinemutator}
  &F \in \contextmutator{\tuple{\dictionary{\N}{\pvmguest}, \sequence{\segment}}} \colon
    (n, \gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}}) \mapsto \begin{cases}
      \Omega_G(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}}) &\when n = \mathtt{gas} \\
      \Omega_Y(\gascounter, \registers, \memory, p, \zerohash, \mathbf{r}, i, \overline{\mathbf{i}}, \overline{\mathbf{x}}, \none, \none, \tup{\mathbf{m}, \mathbf{e}}) &\when n = \mathtt{fetch}\\
      \Omega_H(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}}, w_\wi¬serviceindex, \accounts, (p_\wp¬context)_\wc¬lookupanchortime) &\when n = \mathtt{historical\_lookup}\\
      \Omega_E(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}}, \segoff) &\when n = \mathtt{export}\\
      \Omega_M(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}}) &\when n = \mathtt{machine}\\
      \Omega_P(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}}) &\when n = \mathtt{peek}\\
      \Omega_O(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}}) &\when n = \mathtt{poke}\\
      \Omega_Z(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}}) &\when n = \mathtt{pages}\\
      \Omega_K(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}}) &\when n = \mathtt{invoke}\\
      \Omega_X(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}}) &\when n = \mathtt{expunge}\\
      \tup{\continue, \gascounter - 10, \registers', \memory} &\otherwise\\
      \multicolumn{2}{l}{\where \registers' = \registers \exc \registers'_7 = \mathtt{WHAT}} \\
      \multicolumn{2}{l}{\also \overline{\mathbf{x}} = \sq{\build{
        \sq{\build{
          \mathbf{x}
        }{
          \tup{\blake{\mathbf{x}}, \len{\mathbf{x}}} \orderedin \wiX_\wi¬extrinsics
        }}
      }{
        \wiX \orderedin p_\wp¬workitems
      }}}
    \end{cases}
\end{align}

\subsection{Accumulate Invocation}\label{sec:accumulateinvocation}

Since this is a transition which can directly affect a substantial amount of on-chain state, our invocation context is accordingly complex. It is a tuple with elements for each of the aspects of state which can be altered through this invocation and beyond the account of the service itself includes the deferred transfer list and several dictionaries for alterations to preimage lookup state, core assignments, validator key assignments, newly created accounts and alterations to account privilege levels.

Formally, we define our result context to be $\implications$, and our invocation context to be a pair of these contexts, $\implications \times \implications$ (and thus for any value $\imX \in \implications$ there exists $\imX^2 \in \implications \times \implications$), with one dimension being the regular dimension and generally named $\imX$ and the other being the exceptional dimension and being named $\imY$. The only function which actually alters this second dimension is $\mathtt{checkpoint}$, $\Omega_C$ and so it is rarely seen.
\begin{align}\label{eq:implications}
  \implications &\equiv \tuple{
    \isa{\im¬id}{\serviceid},
    \isa{\im¬state}{\partialstate},
    \isa{\im¬nextfreeid}{\serviceid},
    \isa{\im¬xfers}{\defxfers},
    \isa{\im¬yield}{\optional{\hash}},
    \isa{\im¬provisions}{\protoset{\tuple{\serviceid, \blob}}}
  }\\
  \forall \imX \in \implications :
    \imX_\im¬self &\equiv (\imX_\im¬state)_\ps¬accounts\subb{\imX_\im¬id}
\end{align}

We define a convenience equivalence $\imX_\im¬self$ to easily denote the accumulating service account.

We track both regular and exceptional dimensions within our context mutator, but collapse the result of the invocation to one or the other depending on whether the termination was regular or exceptional (\ie out-of-gas or panic).

We define $\Psi_A$, the Accumulation invocation function as:
\newcommand*{\local¬basestate}{\ao¬poststate}
\begin{align}
  \label{eq:accinvocation}
  \Psi_A& \colon\abracegroup{
    \tuple{
      \partialstate, \timeslot, \serviceid, \gas, \sequence{\operandtuple}
    }
    &\to \acconeout
    \\
    \tup{\local¬basestate, t, s, g, \mathbf{o}} &\mapsto \begin{cases}
      \tup{
        \ao¬poststate,
        \is{\ao¬defxfers}{\sq{}},
        \is{\ao¬yield}{\none},
        \is{\ao¬gasused}{0},
        \is{\ao¬provisions}{\sq{}}
      }
        &\when \mathbf{c} = \none \vee \len{\mathbf{c}} > \Cmaxservicecodesize \\
      C(\Psi_M(\mathbf{c}, 5, g, \encode{t, s, \len{\mathbf{o}}}, F, I(\local¬basestate, s)^2))
        &\otherwise \\
      \where \mathbf{c} = \local¬basestate_\ps¬accounts\subb{s}_\sa¬code&
    \end{cases} \\
  }\\
  I&\colon\abracegroup{
    \tuple{\partialstate, \serviceid} &\to \implications\\
    \tup{\im¬state, \im¬id} &\mapsto \tup{
      \im¬id,
      \im¬state,
      \im¬nextfreeid,
      \is{\im¬xfers}{\sq{}},
      \is{\im¬yield}{\none},
      \is{\im¬provisions}{\sq{}}
    }\\
    &\qquad\where \im¬nextfreeid = \text{check}((\decode[4]{\blake{\encode{\im¬id, \entropyaccumulator', \H_\¬timeslot}}} \bmod (2^{32}-2^9)) + 2^8) \\
  }\\
  F \in \contextmutator{\implicationspair} &\colon \tup{n, \gascounter, \registers, \memory, \imXY} \mapsto \begin{cases}
  \Omega_G(\gascounter, \registers, \memory, \imXY) &\when n = \mathtt{gas} \\
    \Omega_Y(\gascounter, \registers, \memory, \none, \entropyaccumulator', \none, \none, \none, \none, \mathbf{o}, \none, \imXY) &\when n = \mathtt{fetch}\\
    G(\Omega_R(\gascounter, \registers, \memory, \imX_\im¬self, \imX_\im¬id, (\imX_\im¬state)_\ps¬accounts), \imXY) &\when n = \mathtt{read} \\
    G(\Omega_W(\gascounter, \registers, \memory, \imX_\im¬self, \imX_\im¬id), \imXY) &\when n = \mathtt{write} \\
    G(\Omega_L(\gascounter, \registers, \memory, \imX_\im¬self, \imX_\im¬id, (\imX_\im¬state)_\ps¬accounts), \imXY) &\when n = \mathtt{lookup} \\
    G(\Omega_I(\gascounter, \registers, \memory, \imX_\im¬id, (\imX_\im¬state)_\ps¬accounts), \imXY) &\when n = \mathtt{info} \\
    \Omega_B(\gascounter, \registers, \memory, \imXY) &\when n = \mathtt{bless}\\
    \Omega_A(\gascounter, \registers, \memory, \imXY) &\when n = \mathtt{assign}\\
    \Omega_D(\gascounter, \registers, \memory, \imXY) &\when n = \mathtt{designate}\\
    \Omega_C(\gascounter, \registers, \memory, \imXY) &\when n = \mathtt{checkpoint} \\
    \Omega_N(\gascounter, \registers, \memory, \imXY, \H_\¬timeslot) &\when n = \mathtt{new} \\
    \Omega_U(\gascounter, \registers, \memory, \imXY) &\when n = \mathtt{upgrade} \\
    \Omega_T(\gascounter, \registers, \memory, \imXY) &\when n = \mathtt{transfer} \\
    \Omega_J(\gascounter, \registers, \memory, \imXY, \H_\¬timeslot) &\when n = \mathtt{eject} \\
    \Omega_Q(\gascounter, \registers, \memory, \imXY) &\when n = \mathtt{query} \\
    \Omega_S(\gascounter, \registers, \memory, \imXY, \H_\¬timeslot) &\when n = \mathtt{solicit} \\
    \Omega_F(\gascounter, \registers, \memory, \imXY, \H_\¬timeslot) &\when n = \mathtt{forget} \\
    \Omega_\Taurus(\gascounter, \registers, \memory, \imXY) &\when n = \mathtt{yield} \\
    \Omega_\Aries(\gascounter, \registers, \memory, \imXY, \imX_\im¬id) &\when n = \mathtt{provide} \\
    \tup{\continue, \gascounter - 10, \sq{\registers_0, \dots, \registers_6, \mathtt{WHAT}, \registers_8, \dots}, \memory, \imXY} &\otherwise
  \end{cases} \\
  G&\colon\abracegroup{
    \tuple{\tuple{\set{\continue, \halt, \panic, \oog}, \gas, \regs, \ram, \serviceaccount}, \implicationspair} &\to \tuple{\set{\continue, \halt, \panic, \oog}, \gas, \regs, \ram, \implicationspair} \\
    \tup{\tup{\execst, \gascounter, \registers, \memory, \mathbf{s}}, \imXY} &\mapsto \tup{\execst, \gascounter, \registers, \memory, \tup{\imX^*, \imY}} \\
    &\qquad \where \imX^* = \imX \exc \imX^*_\im¬self = \mathbf{s}
  }\\
  C&\colon\abracegroup{
    \tuple{\gas, \blob \cup \set{\oog, \panic}, \implicationspair} &\to \acconeout \\
    \tup{\ao¬gasused, \mathbf{o}, \imXY} &\mapsto \begin{cases}
      \tup{
        \is{\ao¬poststate}{\imY_\im¬state},
        \is{\ao¬defxfers}{\imY_\im¬xfers},
        \is{\ao¬yield}{\imY_\im¬yield},
        \ao¬gasused,
        \is{\ao¬provisions}{\imY_\im¬provisions}
      } & \when \mathbf{o} \in \set{\oog, \panic} \\
      \tup{
        \is{\ao¬poststate}{\imX_\im¬state},
        \is{\ao¬defxfers}{\imX_\im¬xfers},
        \is{\ao¬yield}{\mathbf{o}},
        \ao¬gasused,
        \is{\ao¬provisions}{\imXY_\im¬provisions}
      } & \otherwhen \mathbf{o} \in \hash \\
      \tup{
        \is{\ao¬poststate}{\imX_\im¬state},
        \is{\ao¬defxfers}{\imX_\im¬xfers},
        \is{\ao¬yield}{\imX_\im¬yield},
        \ao¬gasused,
        \is{\ao¬provisions}{\imX_\im¬provisions}
      } & \otherwise \\
    \end{cases}
  }
\end{align}

The mutator $F$ governs how this context will alter for any given parameterization, and the collapse function $C$ selects one of the two dimensions of context depending on whether the virtual machine's halt was regular or exceptional.

The initializer function $I$ maps some partial state along with a service account index to yield a mutator context such that no alterations to the given state are implied in either exit scenario. Note that the component $a$ utilizes the random accumulator $\entropyaccumulator'$ and the block's timeslot $\H_\¬timeslot$ to create a deterministic sequence of identifiers which are extremely likely to be unique.

Concretely, we create the identifier from the Blake2 hash of the identifier of the creating service, the current random accumulator $\entropyaccumulator'$ and the block's timeslot. Thus, within a service's accumulation it is almost certainly unique, but it is not necessarily unique across all services, nor at all times in the past. We utilize a \emph{check} function to find the first such index in this sequence which does not already represent a service:
\begin{equation}
  \text{check}(i \in \serviceid) \equiv \begin{cases}
    i &\when i \not\in \keys{\local¬basestate_\ps¬accounts} \\
    \text{check}((i - 2^8 + 1) \bmod (2^{32}-2^9) + 2^8)&\otherwise
  \end{cases}
\end{equation}

\nb In the highly unlikely event that a block executes to find that a single service index has inadvertently been attached to two different services, then the block is considered invalid. Since no service can predict the identifier sequence ahead of time, they cannot intentionally disadvantage the block author.

\undef{\local¬basestate}
\subsection{On-Transfer Invocation}\label{sec:ontransferinvocation}

We define the On-Transfer service-account invocation function as $\Psi_T$; it is somewhat similar to the Accumulation Invocation except that the only state alteration it facilitates are basic alteration to the storage of the subject account. No further transfers may be made, no privileged operations are possible, no new accounts may be created nor other operations done on the subject account itself. The function is defined as:
\begin{align}
  \label{eq:onxferinvocation}
  \Psi_T &: \begin{cases}
    \tuple{\dictionary{\serviceid}{\serviceaccount}, \timeslot, \serviceid, \defxfers}
    &\to \tuple{\serviceaccount, \gas} \\
    \tup{\mathbf{d}, t, s, \mathbf{t}} &\mapsto \begin{cases}
      \tup{\mathbf{s}, 0}
        &\when \mathbf{s}_\sa¬code = \none \vee
          \len{\mathbf{s}_\sa¬code} > \Cmaxservicecodesize \vee
          \mathbf{t} = \sq{} \\
      \tup{\mathbf{s}', u} &\otherwise \\
      \multicolumn{2}{l}{
        \begin{aligned}
          \quad\where \tup{u, \mathbf{r}, \mathbf{s}'} &= \Psi_M(
            \mathbf{s}_\sa¬code,
            10,
            \sum_{r \in \mathbf{t}}{(r_\dx¬gas)},
            \encode{t, s, \len{\mathbf{t}}},
            F,
            \mathbf{s}
          ) \\
          \quad\also \mathbf{s} &= \mathbf{d}\subb{s} \exc \mathbf{s}_\sa¬balance = \mathbf{d}\subb{s}_\sa¬balance + \sum_{r \in \mathbf{t}}{r_\dx¬amount} \\
        \end{aligned}
      }
    \end{cases} \\
  \end{cases} \\
  \also F &\in \contextmutator{\serviceaccount}\colon \tup{n, \gascounter, \registers, \memory, \mathbf{s}} \equiv \begin{cases}
    \Omega_G(\gascounter, \registers, \memory) &\when n = \mathtt{gas} \\
    \Omega_Y(\gascounter, \registers, \memory, \none, \entropyaccumulator', \none, \none, \none, \none, \none, \mathbf{t}) &\when n = \mathtt{fetch}\\
    \Omega_L(\gascounter, \registers, \memory, \mathbf{s}, s, \mathbf{d}) &\when n = \mathtt{lookup} \\
    \Omega_R(\gascounter, \registers, \memory, \mathbf{s}, s, \mathbf{d}) &\when n = \mathtt{read} \\
    \Omega_W(\gascounter, \registers, \memory, \mathbf{s}, s) &\when n = \mathtt{write} \\
    \Omega_I(\gascounter, \registers, \memory, s, \mathbf{d}) &\when n = \mathtt{info} \\
    \tup{\continue, \gascounter - 10, \sq{\registers_0, \dots, \registers_6, \mathtt{WHAT}, \registers_8, \dots}, \memory, \mathbf{s}} &\otherwise
  \end{cases}
\end{align}







\subsection{General Functions}\label{sec:generalfunctions}

We come now to defining the host functions which are utilized by the \textsc{pvm} invocations. Generally, these map some \textsc{pvm} state, including invocation context, possibly together with some additional parameters, to a new \textsc{pvm} state.

The general functions are all broadly of the form $\tup{\gascounter' \in \signedgas, \registers' \in \regs, \memory' \in \ram} = \Omega_\square(\gascounter \in \gas, \registers \in \regs, \memory \in \ram)$. Functions which have a result component which is equivalent to the corresponding argument may have said components elided in the description. Functions may also depend upon particular additional parameters.

Unlike the Accumulate functions in appendix \ref{sec:accumulatefunctions}, these do not mutate an accumulation context. Some, such as $\mathtt{write}$ mutate a service account and both accept and return some $\mathbf{s} \in \serviceaccount$. Others are more general functions, such as $\mathtt{fetch}$ and do not assume any context but have a parameter list suffixed with an ellipsis to denote that the context parameter may be taken and is provided transparently into its result. This allows it to be easily utilized in multiple \textsc{pvm} invocations.

Other than the gas-counter which is explicitly defined, elements of \textsc{pvm} state are each assumed to remain unchanged by the host-call unless explicitly specified.
\begin{align}
  \gascounter' &\equiv \gascounter - g\\
  \tup{\execst', \registers', \memory', \mathbf{s}'} &\equiv \begin{cases}
    \tup{\oog, \registers, \memory, \mathbf{s}} &\when \gascounter < g\\
    \tup{\continue, \registers, \memory, \mathbf{s}} \text{ except as indicated below} &\otherwise
  \end{cases}
\end{align}

\aboverulesep = 1.5mm \belowrulesep = 2mm

\begin{longtable}{p{3.5cm} p{12.5cm}}
  \toprule
  \thead*{\textbf{Function} \\ \textbf{Identifier} \\ \textbf{Gas usage}} &
  \thead{\textbf{Mutations}} \\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \endhead
  \makecell*[l]{
  $\Omega_G(\gascounter, \registers, \dots)$ \\
  \texttt{gas} = 0 \\
  $g = 10$} &
  $\begin{aligned}
    \registers'_7 &\equiv \gascounter'
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_Y(\gascounter, \registers, \memory, p, n, \mathbf{r}, i, \overline{\mathbf{i}}, \overline{\mathbf{x}}, \mathbf{o}, \mathbf{t}, \dots)$ \\
  \texttt{fetch} = 1 \\
  $g = 10$} &
  $\begin{aligned}
    \using \mathbf{v} &= \begin{cases}
      \mathbf{c} &\when \registers_{10} = 0 \\
      \multicolumn{2}{l}{\where \mathbf{c} = \encode{
        \begin{aligned}
          &\encode[8]{\Citemdeposit},
          \encode[8]{\Cbytedeposit},
          \encode[8]{\Cbasedeposit},
          \encode[2]{\Ccorecount},
          \encode[4]{\Cexpungeperiod},
          \encode[4]{\Cepochlen},
          \encode[8]{\Creportaccgas},\\
          &\encode[8]{\Cpackageauthgas},
          \encode[8]{\Cpackagerefgas},
          \encode[8]{\Cblockaccgas},
          \encode[2]{\Crecenthistorylen},
          \encode[2]{\Cmaxpackageitems},
          \encode[2]{\Cmaxreportdeps},
          \encode[2]{\Cmaxblocktickets},\\
          &\encode[4]{\Cmaxlookupanchorage},
          \encode[2]{\Cticketentries},
          \encode[2]{\Cauthpoolsize},
          \encode[2]{\Cslotseconds},
          \encode[2]{\Cauthqueuesize},
          \encode[2]{\Crotationperiod},
          \encode[2]{\Cmaxpackagexts},
          \encode[2]{\Cassurancetimeoutperiod},\\
          &\encode[2]{\Cvalcount},
          \encode[4]{\Cmaxauthcodesize},
          \encode[4]{\Cmaxbundlesize},
          \encode[4]{\Cmaxservicecodesize},
          \encode[4]{\Cecpiecesize},
          \encode[4]{\Cmaxpackageimports},\\
          &\encode[4]{\Csegmentecpieces},
          \encode[4]{\Cmaxreportvarsize},
          \encode[4]{\Cmemosize},
          \encode[4]{\Cmaxpackageexports},
          \encode[4]{\Cepochtailstart}
        \end{aligned}
      }}\\
      n &\when n \ne \none \wedge \registers_{10} = 1 \\
      \mathbf{r} &\when \mathbf{r} \ne \none \wedge \registers_{10} = 2 \\
      \overline{\mathbf{x}}[\registers_{11}]_{\registers_{12}} &\when \overline{\mathbf{x}} \ne \none \wedge \registers_{10} = 3 \wedge \registers_{11} < \len{\overline{\mathbf{x}}} \wedge \registers_{12} < \len{\overline{\mathbf{x}}[\registers_{11}]} \\
      \overline{\mathbf{x}}\subb{i}_{\registers_{11}} &\when \overline{\mathbf{x}} \ne \none \wedge i \ne \none \wedge \registers_{10} = 4 \wedge \registers_{11} < \len{\overline{\mathbf{x}}\subb{i}} \\
      \overline{\mathbf{i}}[\registers_{11}]_{\registers_{12}} &\when \overline{\mathbf{i}} \ne \none \wedge \registers_{10} = 5 \wedge \registers_{11} < \len{\overline{\mathbf{i}}} \wedge \registers_{12} < \len{\overline{\mathbf{i}}[\registers_{11}]} \\
      \overline{\mathbf{i}}\subb{i}_{\registers_{11}} &\when \overline{\mathbf{i}} \ne \none \wedge i \ne \none \wedge \registers_{10} = 6 \wedge \registers_{11} < \len{\overline{\mathbf{i}}\subb{i}} \\
      \encode{p} &\when p \ne \none \wedge \registers_{10} = 7 \\
      \encode{p_\wp¬authcodehash, \var{p_\wp¬authconfig}} &\when p \ne \none \wedge \registers_{10} = 8 \\
      p_\wp¬authtoken &\when p \ne \none \wedge \registers_{10} = 9 \\
      \encode{p_\wp¬context} &\when p \ne \none \wedge \registers_{10} = 10 \\
      \encode{\var{\sq{\build{S(w)}{w \orderedin p_\wp¬workitems}}}} &\when p \ne \none \wedge \registers_{10} = 11 \\
      S(p_\wp¬workitems[\registers_{11}]) &\when p \ne \none \wedge \registers_{10} = 12 \wedge \registers_{11} < \len{p_\wp¬workitems} \\
      \multicolumn{2}{l}{\where S(w) \equiv \encode{\encode[4]{w_\wi¬serviceindex}, w_\wi¬codehash, \encode[8]{w_\wi¬refgaslimit, w_\wi¬accgaslimit}, \encode[2]{w_\wi¬exportcount, \len{w_\wi¬importsegments}, \len{w_\wi¬extrinsics}}, \encode[4]{\len{w_\wi¬payload}}}} \\
      p_\wp¬workitems[\registers_{11}]_\wi¬payload &\when p \ne \none \wedge \registers_{10} = 13 \wedge \registers_{11} < \len{p_\wp¬workitems} \\
      \encode{\var{\mathbf{o}}} &\when \mathbf{o} \ne \none \wedge \registers_{10} = 14 \\
      \encode{\mathbf{o}[\registers_{11}]} &\when \mathbf{o} \ne \none \wedge \registers_{10} = 15 \wedge \registers_{11} < \len{\mathbf{o}} \\
      \encode{\var{\mathbf{t}}} &\when \mathbf{t} \ne \none \wedge \registers_{10} = 16 \\
      \encode{\mathbf{t}[\registers_{11}]} &\when \mathbf{t} \ne \none \wedge \registers_{10} = 17 \wedge \registers_{11} < \len{\mathbf{t}} \\
      \none &\otherwise
    \end{cases} \\
    \using o &= \registers_7 \\
    \using f &= \min(\registers_8, \len{\mathbf{v}}) \\
    \using l &= \min(\registers_9, \len{\mathbf{v}} - f) \\
    \tup{\execst', \registers'_7, \memory'\subrange{o}{l}} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \memory\subrange{o}{l}} &\when \Nrange{o}{l} \not\subseteq \writable{\memory} \\
      \tup{\continue, \mathtt{NONE}, \memory\subrange{o}{l}} &\otherwhen \mathbf{v} = \none \\
      \tup{\continue, \len{\mathbf{v}}, \mathbf{v}\subrange{f}{l}} &\otherwise \\
    \end{cases}
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_L(\gascounter, \registers, \memory, \mathbf{s}, s, \mathbf{d})$ \\
  \texttt{lookup} = 2 \\
  $g = 10$} &
  $\begin{aligned}
    \using \mathbf{a} &= \begin{cases}
      \mathbf{s} &\when \registers_7 \in \set{ s, 2^{64} - 1 } \\
      \mathbf{d}[\registers_7] &\otherwhen \registers_7 \in \keys{\mathbf{d}} \\
      \none &\otherwise
    \end{cases} \\
    \using \sq{h, o} &= \registers\subrange{8}{2} \\
    \using \mathbf{v} &= \begin{cases}
      \error &\when \Nrange{h}{32} \not\subseteq \readable{\memory} \\
      \none &\otherwhen \mathbf{a} = \none \vee \memory\subrange{h}{32} \not\in \keys{\mathbf{a}_\sa¬preimages} \\
      \mathbf{a}_\sa¬preimages[\memory\subrange{h}{32}] &\otherwise \\
    \end{cases} \\
    \using f &= \min(\registers_{10}, \len{\mathbf{v}}) \\
    \using l &= \min(\registers_{11}, \len{\mathbf{v}} - f) \\
    \tup{\execst', \registers'_7, \memory'\subrange{o}{l}} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \memory\subrange{o}{l}} &\when \mathbf{v} = \error \vee \Nrange{o}{l} \not\subseteq \writable{\memory}\\
      \tup{\continue, \mathtt{NONE}, \memory\subrange{o}{l}} &\otherwhen \mathbf{v} = \none \\
      \tup{\continue, \len{\mathbf{v}}, \mathbf{v}\subrange{f}{l}} &\otherwise \\
    \end{cases}
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_R(\gascounter, \registers, \memory, \mathbf{s}, s, \mathbf{d})$ \\
  \texttt{read} = 3 \\
  $g = 10$} &
  % gas cost for cold reads dependent on trie depth.
  $\begin{aligned}
    \using s^* &= \begin{cases}
      s &\when \registers_7 = 2^{64} - 1 \\
      \registers_7 &\otherwise
    \end{cases} \\
    \using \mathbf{a} &= \begin{cases}
      \mathbf{s} &\when s^* = s \\
      \mathbf{d}[s^*] &\otherwhen s^* \in \keys{\mathbf{d}} \\
      \none &\otherwise
    \end{cases} \\
    \using \sq{k_O, k_Z, o} &= \registers\subrange{8}{3} \\
    \using \mathbf{v} &= \begin{cases}
      \error &\when \Nrange{k_O}{k_Z} \not\subseteq \readable{\memory} \\
      \mathbf{a}_\sa¬storage\subb{\mathbf{k}} &\otherwhen \mathbf{a} \ne \none \wedge \mathbf{k} \in \keys{\mathbf{a}_\sa¬storage}\,,\ \where \mathbf{k} = \memory\subrange{k_O}{k_Z} \\
      \none &\otherwise
    \end{cases} \\
    \using f &= \min(\registers_{11}, \len{\mathbf{v}}) \\
    \using l &= \min(\registers_{12}, \len{\mathbf{v}} - f) \\
    \tup{\execst', \registers'_7, \memory'\subrange{o}{l}} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \memory\subrange{o}{l}} &\when \mathbf{v} = \error \vee \Nrange{o}{l} \not\subseteq \writable{\memory}\\
      \tup{\continue, \mathtt{NONE}, \memory\subrange{o}{l}} &\otherwhen \mathbf{v} = \none \\
      \tup{\continue, \len{\mathbf{v}}, \mathbf{v}\subrange{f}{l}} &\otherwise \\
    \end{cases}
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_W(\gascounter, \registers, \memory, \mathbf{s}, s)$ \\
  \texttt{write} = 4 \\
  $g = 10$
  } &
  $\begin{aligned}
    \using \sq{k_O, k_Z, v_O, v_Z} &= \registers\subrange{7}{4} \\
    \using \mathbf{k} &= \begin{cases}
      \memory\subrange{k_O}{k_Z} &\when \Nrange{k_O}{k_Z} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \using \mathbf{a} &= \begin{cases}
      \mathbf{s}\,,\ \exc \keys{\mathbf{a}_\sa¬storage} = \keys{\mathbf{a}_\sa¬storage} \setminus \set{k} & \when v_Z = 0 \\
      \mathbf{s}\,,\ \exc \mathbf{a}_\sa¬storage\subb{\mathbf{k}} = \memory\subrange{v_O}{v_Z} &\otherwhen \Nrange{v_O}{v_Z} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \using l &= \begin{cases}
      \len{\mathbf{s}_\sa¬storage\subb{k}} &\when \mathbf{k} \in \keys{\mathbf{s}_\sa¬storage} \\
      \mathtt{NONE} &\otherwise
    \end{cases} \\
    \tup{\execst', \registers'_7, \mathbf{s}'} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \mathbf{s}} &\when \mathbf{k} = \error \vee \mathbf{a} = \error\\
      \tup{\continue, \mathtt{FULL}, \mathbf{s}} &\otherwhen \mathbf{a}_\sa¬minbalance > \mathbf{a}_\sa¬balance \\
      \tup{\continue, l, \mathbf{a}} &\otherwise\\
    \end{cases}
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_I(\gascounter, \registers, \memory, s, \mathbf{d})$ \\
  \texttt{info} = 5 \\
  $g = 10$} &
  $\begin{aligned}
    \using \mathbf{a} &= \begin{cases}
      \mathbf{d}\subb{s} &\when \registers_7 = 2^{64} - 1 \\
      \mathbf{d}\subb{\registers_7} &\otherwise
    \end{cases} \\
    \using o &= \registers_8 \\
    \using \mathbf{v} &= \begin{cases}
      \encode{
        \mathbf{a}_\sa¬codehash,
        \encode[8]{\mathbf{a}_\sa¬balance, \mathbf{a}_\sa¬minbalance, \mathbf{a}_\sa¬minaccgas, \mathbf{a}_\sa¬minmemogas, \mathbf{a}_\sa¬octets},
        \encode[4]{\mathbf{a}_\sa¬items},
        \encode[8]{\mathbf{a}_\sa¬gratis},
        \encode[4]{\mathbf{a}_\sa¬created, \mathbf{a}_\sa¬lastacc, \mathbf{a}_\sa¬parent}
      } &\when \mathbf{a} \ne \none \\
      \none &\otherwise
    \end{cases} \\
    \using f &= \min(\registers_{11}, \len{\mathbf{v}}) \\
    \using l &= \min(\registers_{12}, \len{\mathbf{v}} - f) \\
    \tup{\execst', \registers'_7, \memory'\subrange{o}{l}} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \memory\subrange{o}{l}} &\when \mathbf{v} = \error \vee \Nrange{o}{l} \not\subseteq \writable{\memory}\\
      \tup{\continue, \mathtt{NONE}, \memory\subrange{o}{l}} &\otherwhen \mathbf{v} = \none \\
      \tup{\continue, \len{\mathbf{v}}, \mathbf{v}\subrange{f}{l}} &\otherwise \\
    \end{cases}
  \end{aligned}$ \\
  \bottomrule
\end{longtable}

\subsection{Refine Functions}\label{sec:refinefunctions}

These assume some refine context pair $\tup{\mathbf{m}, \mathbf{e}} \in \tuple{\dictionary{\N}{\pvmguest}, \sequence{\segment}}$, which are both initially empty. Other than the gas-counter which is explicitly defined, elements of \textsc{pvm} state are each assumed to remain unchanged by the host-call unless explicitly specified.
\begin{align}
  \gascounter' &\equiv \gascounter - g\\
  \tup{\execst', \registers', \memory'} &\equiv \begin{cases}
    \tup{\oog, \registers, \memory} &\when \gascounter < g\\
    \tup{\continue, \registers, \memory} \text{ except as indicated below} &\otherwise
  \end{cases}
\end{align}

\begin{longtable}{p{4cm} p{12cm}}
  \toprule
  \thead*{\textbf{Function} \\ \textbf{Identifier} \\ \textbf{Gas usage}} &
  \thead{\textbf{Mutations}} \\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \endhead
  \makecell*[l]{
  $\Omega_H(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}}, s, \mathbf{d}, t)$ \\
  \texttt{historical\_lookup} = 6 \\
  $g = 10$} &
  $\begin{aligned}
    \using \mathbf{a} &= \begin{cases}
      \mathbf{d}\subb{s} &\when \registers_7 = 2^{64} - 1 \wedge s \in \keys{\mathbf{d}} \\
      \mathbf{d}[\registers_7] &\when \registers_7 \in \keys{\mathbf{d}} \\
      \none &\otherwise
    \end{cases} \\
    \using \sq{h, o} &= \registers\subrange{8}{2} \\
    \using \mathbf{v} &= \begin{cases}
      \error &\when \Nrange{h}{32} \not\subseteq \readable{\memory} \\
      \none &\otherwhen \mathbf{a} = \none \\
      \histlookup(\mathbf{a}, t, \memory\subrange{h}{32}) &\otherwise \\
    \end{cases} \\
    \using f &= \min(\registers_{10}, \len{\mathbf{v}}) \\
    \using l &= \min(\registers_{11}, \len{\mathbf{v}} - f) \\
    \tup{\execst', \registers'_7, \memory'\subrange{o}{l}} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \memory\subrange{o}{l}} &\when \mathbf{v} = \error \vee \Nrange{o}{l} \not\subseteq \writable{\memory}\\
      \tup{\continue, \mathtt{NONE}, \memory\subrange{o}{l}} &\otherwhen \mathbf{v} = \none \\
      \tup{\continue, \len{\mathbf{v}}, \mathbf{v}\subrange{f}{l}} &\otherwise \\
    \end{cases}
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_E(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}}, \segoff)$ \\
  \texttt{export} = 7 \\
  $g = 10$} &
  $\begin{aligned}
    \using p &= \registers_7 \\
    \using z &= \min(\registers_8, \Csegmentsize) \\
    \using \mathbf{x} &= \begin{cases}
      \zeropad{\Csegmentsize}{\mem\subrange{p}{z}} &\when \Nrange{p}{z} \subseteq \readable[\memory]\\
      \error &\otherwise
    \end{cases}\\
    \tup{\execst', \registers'_7, \mathbf{e}'} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \mathbf{e}} &\when \mathbf{x} = \error \\
      \tup{\continue, \mathtt{FULL}, \mathbf{e}} &\otherwhen \segoff+\len{\mathbf{e}} \ge \Cmaxpackageexports \\
      \tup{\continue, \segoff + \len{\mathbf{e}}, \mathbf{e} \append \mathbf{x}} &\otherwise
    \end{cases}
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_M(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}})$ \\
  \texttt{machine} = 8 \\
  $g = 10$} &
  $\begin{aligned}
    \using \sq{p_O, p_Z, i} &= \registers\subrange{7}{3} \\
    \using \mathbf{p} &= \begin{cases}
      \memory\subrange{p_O}{p_Z} &\when \Nrange{p_O}{p_Z} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \using n &= \min(n \in \N, n \not\in \keys{\mathbf{m}}) \\
    \using \mathbf{u} &= \tup{\is{\ram¬value}{[0, 0, \dots]},\is{\ram¬access}{[\none, \none, \dots]}} \\
    \tup{\execst', \registers'_7, \mathbf{m}} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \mathbf{m}} &\when \mathbf{p} = \error \\
      \tup{\continue, \mathtt{HUH}, \mathbf{m}} &\otherwhen \deblob(\mathbf{p}) = \error \\
      \tup{\continue, n, \mathbf{m} \cup \set{\kv{n}{\tup{\mathbf{p}, \mathbf{u}, i}}} } &\otherwise \\
    \end{cases} \\
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_P(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}})$ \\
  \texttt{peek} = 9 \\
  $g = 10$} &
  $\begin{aligned}
    \using \sq{n, o, s, z} &= \registers\subrange{7}{4} \\
    \tup{\execst', \registers'_7, \mem'} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \mem} &\when \Nrange{o}{z} \not\subseteq \writable[\memory] \\
      \tup{\continue, \mathtt{WHO}, \mem} &\otherwhen n \not\in \keys{\mathbf{m}} \\
      \tup{\continue, \mathtt{OOB}, \mem} &\otherwhen \Nrange{s}{z} \not\subseteq \readable{\mathbf{m}\subb{n}_\pg¬ram} \\
      \tup{\continue, \mathtt{OK}, \mem'} &\otherwise \\
      \multicolumn{2}{l}{\where \mem' = \mem \exc \mem\subrange{o}{z} = (\mathbf{m}\subb{n}_\pg¬ram)\subrange{s}{z}}
    \end{cases} \\
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_O(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}})$ \\
  \texttt{poke} = 10 \\
  $g = 10$} &
  $\begin{aligned}
    \using \sq{n, s, o, z} &= \registers\subrange{7}{4} \\
    \tup{\execst', \registers'_7, \mathbf{m}'} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \mathbf{m}} &\when \Nrange{s}{z} \not\subseteq \readable[\memory] \\
      \tup{\continue, \mathtt{WHO}, \mathbf{m}} &\otherwhen n \not\in \keys{\mathbf{m}} \\
      \tup{\continue, \mathtt{OOB}, \mathbf{m}} &\otherwhen \Nrange{o}{z} \not\subseteq \writable{\mathbf{m}\subb{n}_\pg¬ram} \\
      \tup{\continue, \mathtt{OK}, \mathbf{m}'}  &\otherwise \\
      \multicolumn{2}{l}{\where \mathbf{m}' = \mathbf{m} \exc (\mathbf{m}'\subb{n}_\pg¬ram)\subrange{o}{z} = \mem\subrange{s}{z}}
    \end{cases} \\
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_Z(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}})$ \\
  \texttt{pages} = 11 \\
  $g = 10$} &
  $\begin{aligned}
    \using \sq{n, p, c, r} &= \registers\subrange{7}{4} \\
    \using \mathbf{u} &= \begin{cases}
      \mathbf{m}\subb{n}_\pg¬ram &\when n \in \keys{\mathbf{m}} \\
      \error &\otherwise\\
    \end{cases} \\
    \using \mathbf{u}' &= \mathbf{u} \exc \begin{cases}
      (\mathbf{u}'_\ram¬value)_{p\Cpvmpagesize\dots+c\Cpvmpagesize} = \begin{cases}
       \sq{0, 0, \dots} &\when r < 3 \\
        (\mathbf{u}_\ram¬value)_{p\Cpvmpagesize\dots+c\Cpvmpagesize} &\otherwise
      \end{cases} \\
      (\mathbf{u}'_\ram¬access)\subrange{p}{c} = \begin{cases}
       \sq{\none, \none, \dots} &\when r = 0 \\
       \sq{\mathrm{R}, \mathrm{R}, \dots} &\when r = 1 \vee r = 3 \\
       \sq{\mathrm{W}, \mathrm{W}, \dots} &\when r = 2 \vee r = 4 \\
      \end{cases}
    \end{cases}\\
    \tup{\registers'_7, \mathbf{m}'} &\equiv \begin{cases}
      \tup{\mathtt{WHO}, \mathbf{m}} &\when \mathbf{u} = \error \\
      \tup{\mathtt{HUH}, \mathbf{m}} &\otherwhen r > 4 \vee p < 16 \vee p+c \ge \nicefrac{2^{32}}{\Cpvmpagesize} \\
      \tup{\mathtt{HUH}, \mathbf{m}} &\otherwhen r > 2 \wedge (\mathbf{u}_\ram¬access)\subrange{p}{c} \ni \none \\
      \tup{\mathtt{OK}, \mathbf{m}'} &\otherwise\,,\ \where \mathbf{m}' = \mathbf{m} \exc \mathbf{m}'\subb{n}_\pg¬ram = \mathbf{u}' \\
    \end{cases} \\
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_K(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}})$ \\
  \texttt{invoke} = 12 \\
  $g = 10$} &
  $\begin{aligned}
    \using \sq{n, o} &= \registers_{7, 8} \\
    \using \tup{g, \mathbf{w}} &= \begin{cases}
      \tup{g, \mathbf{w}}: \encode[8]{g} \concat \encode[8]{\mathbf{w}} = \mem\subrange{o}{112} &\when \Nrange{o}{112} \subseteq \writable{\mem} \\
      %\tup{\decode[8]{\memr\subrange{o}{8}}, \sq{\build{\decode[4]{\memr\subrange{o+8+8x}{8}}}{x \orderedin \Nmax{13}}}} &\when \Nrange{o}{60} \subset \writable_\mem} \\
      \tup{\error, \error} &\otherwise
    \end{cases} \\
    \using \tup{c, i', g', \mathbf{w}', \mathbf{u}'} &= \Psi(\mathbf{m}\subb{n}_\pg¬code, \mathbf{m}\subb{n}_\pg¬pc, g, \mathbf{w}, \mathbf{m}\subb{n}_\pg¬ram)\\
    \using \mem^* &= \mem \exc \mem^*\subrange{o}{112} = \encode[8]{g'} \concat \encode[8]{\mathbf{w}'}\\
    \using \mathbf{m}^* &= \mathbf{m} \exc \begin{cases}
      \mathbf{m}^*\subb{n}_\pg¬ram = \mathbf{u}'\\
      \mathbf{m}^*\subb{n}_\pg¬pc = \begin{cases}
        i' + 1 &\when c \in \set{ \host } \times \pvmreg\\
        i' &\otherwise
      \end{cases}
    \end{cases}\\
    \tup{\execst', \registers'_7, \registers'_8, \mem', \mathbf{m}'} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \registers_8, \mem, \mathbf{m}} &\when g = \error \\
      \tup{\continue, \mathtt{WHO}, \registers_8, \mem, \mathbf{m}} &\otherwhen n \not\in \mathbf{m} \\
      \tup{\continue, \mathtt{HOST}, h, \mem^*, \mathbf{m}^*} &\otherwhen c = \host \times h \\
      \tup{\continue, \mathtt{FAULT}, x, \mem^*, \mathbf{m}^*} &\otherwhen c = \fault \times x \\
      \tup{\continue, \mathtt{OOG}, \registers_8, \mem^*, \mathbf{m}^*} &\otherwhen c = \oog \\
      \tup{\continue, \mathtt{PANIC}, \registers_8, \mem^*, \mathbf{m}^*} &\otherwhen c = \panic \\
      \tup{\continue, \mathtt{HALT}, \registers_8, \mem^*, \mathbf{m}^*} &\otherwhen c = \halt \\
    \end{cases} \\
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_X(\gascounter, \registers, \memory, \tup{\mathbf{m}, \mathbf{e}})$ \\
  \texttt{expunge} = 13 \\
  $g = 10$} &
  $\begin{aligned}
    \using n &= \registers_7 \\
    \tup{\registers'_7, \mathbf{m}'} &\equiv \begin{cases}
      \tup{\mathtt{WHO}, \mathbf{m}} &\when n \not\in \keys{\mathbf{m}} \\
      \tup{\mathbf{m}\subb{n}_\pg¬pc, \mathbf{m} \setminus n} &\otherwise \\
    \end{cases} \\
  \end{aligned}$\\
  \bottomrule
\end{longtable}

\subsection{Accumulate Functions}\label{sec:accumulatefunctions}

This defines a number of functions broadly of the form $(\gascounter' \in \signedgas, \registers' \in \regs, \memory', \tup{\imX', \mathbf{y}'}) = \Omega_\square(\gascounter \in \gas, \registers \in \regs, \memory \in \ram, \imXY \in \implications^2, \dots)$. Functions which have a result component which is equivalent to the corresponding argument may have said components elided in the description. Functions may also depend upon particular additional parameters.

Other than the gas-counter which is explicitly defined, elements of \textsc{pvm} state are each assumed to remain unchanged by the host-call unless explicitly specified.
\begin{align}
  \gascounter' &\equiv \gascounter - g\\
  \tup{\execst', \registers', \memory', \imX', \mathbf{y}'} &\equiv \begin{cases}
    \tup{\oog, \registers, \memory, \mathbf{x}, \mathbf{y}} &\when \gascounter < g\\
    \tup{\continue, \registers, \memory, \mathbf{x}, \mathbf{y}} \text{ except as indicated below} &\otherwise
  \end{cases}
\end{align}

\begin{longtable}{p{3.5cm} p{12.5cm}}
  \toprule
  \thead*{\textbf{Function} \\ \textbf{Identifier} \\ \textbf{Gas usage}} &
  \thead{\textbf{Mutations}} \\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \endhead
  \makecell*[l]{
  $\Omega_B(\gascounter, \registers, \memory, \imXY)$ \\
  \texttt{bless} = 14 \\
  $g = 10$}&
  $\begin{aligned}
    \using \sq{m, a, v, o, n} &= \registers\subrange{7}{5} \\
    \using \mathbf{a} &= \begin{cases}
      \decode[4]{\memory\subrange{a}{4\Ccorecount}} &\when \Nrange{a}{4\Ccorecount} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \using \mathbf{z} &= \begin{cases}
      \set{\build{\kv{s}{g} \ \where \encode[4]{s} \concat \encode[8]{g} = \memory\subrange{o+12i}{12}}{i \in \Nmax{n}}} &\when \Nrange{o}{12n} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \tup{\execst', \registers'_7, (\imX'_\im¬state)_{\tup{\ps¬manager, \ps¬assigners, \ps¬delegator, \ps¬alwaysaccers}}} &= \begin{cases}
      \tup{\panic, \registers_7, (\imX_\im¬state)_{\tup{\ps¬manager, \ps¬assigners, \ps¬delegator, \ps¬alwaysaccers}}} &\when \set{\mathbf{z}, \mathbf{a}} \ni \error \\
      \tup{\continue, \mathtt{HUH}, (\imX_\im¬state)_{\tup{\ps¬manager, \ps¬assigners, \ps¬delegator, \ps¬alwaysaccers}}} &\otherwhen \imX_\im¬id \ne (\imX_\im¬state)_\ps¬manager\\
      \tup{\continue, \mathtt{WHO}, (\imX_\im¬state)_{\tup{\ps¬manager, \ps¬assigners, \ps¬delegator, \ps¬alwaysaccers}}} &\otherwhen \tup{m, v} \not\in \tuple{\serviceid, \serviceid} \\
      \tup{\continue, \mathtt{OK}, \tuple{m, \mathbf{a}, v, \mathbf{z}}} &\otherwise \\
    \end{cases}
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_A(\gascounter, \registers, \memory, \imXY)$ \\
  \texttt{assign} = 15 \\
  $g = 10$} &
  $\begin{aligned}
    \using \sq{c, o, a} &= \registers\subrange{7}{3} \\
    \using \mathbf{q} &= \begin{cases}
      \sq{\build{\memory\subrange{o + 32i}{32}}{i \orderedin \N_\Cauthqueuesize}} &\when \Nrange{o}{32\Cauthqueuesize} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \tup{\execst', \registers'_7, (\imX'_\im¬state)_\ps¬authqueue\subb{c}, (\imX'_\im¬state)_\ps¬assigners\subb{c}} &= \begin{cases}
      \tup{\panic, \registers_7, (\imX_\im¬state)_\ps¬authqueue\subb{c}, (\imX_\im¬state)_\ps¬assigners\subb{c}} &\when \mathbf{q} = \error \\
      \tup{\continue, \mathtt{CORE}, (\imX_\im¬state)_\ps¬authqueue\subb{c}, (\imX_\im¬state)_\ps¬assigners\subb{c}} &\otherwhen c \ge \Ccorecount \\
      \tup{\continue, \mathtt{HUH}, (\imX_\im¬state)_\ps¬authqueue\subb{c}, (\imX_\im¬state)_\ps¬assigners\subb{c}} &\otherwhen \imX_\im¬id \ne (\imX_\im¬state)_\ps¬assigners\subb{c}\\
      \tup{\continue, \mathtt{OK}, \mathbf{q}, a} &\otherwise \\
    \end{cases} \\
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_D(\gascounter, \registers, \memory, \imXY)$ \\
  \texttt{designate} = 16 \\
  $g = 10$} &
  $\begin{aligned}
    \using o &= \registers_7 \\
    \using \mathbf{v} &= \begin{cases}
      \sq{\build{\memory\subrange{o + 336i}{336}}{i \orderedin \valindex}} &\when \Nrange{o}{336\Cvalcount} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \tup{\execst', \registers'_7, (\imX'_\im¬state)_\ps¬stagingset} &= \begin{cases}
      \tup{\panic, \registers_7, (\imX_\im¬state)_\ps¬stagingset} &\when \mathbf{v} = \error\\
      \tup{\continue, \mathtt{HUH}, (\imX_\im¬state)_\ps¬stagingset} &\otherwhen \imX_\im¬id \ne (\imX_\im¬state)_\ps¬delegator\\
      \tup{\continue, \mathtt{OK}, \mathbf{v}} &\otherwise \\
    \end{cases} \\
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_C(\gascounter, \registers, \memory, \imXY)$ \\
  \texttt{checkpoint} = 17 \\
  $g = 10$} &
  $\begin{aligned}
    \imY' &\equiv \imX \\
    \registers'_7 &\equiv \gascounter'
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_N(\gascounter, \registers, \memory, \imXY, t)$ \\
  \texttt{new} = 18 \\
  $g = 10$} &
  $\begin{aligned}
    \using \sq{o, l, \sa¬minaccgas, \sa¬minmemogas, \sa¬gratis} &= \registers\subrange{7}{5} \\
    \using \sa¬codehash &= \begin{cases}
      \memory\subrange{o}{32} &\when \Nrange{o}{32} \subseteq \readable{\memory} \wedge l \in \Nbits{32} \\
      \error &\otherwise
    \end{cases}\\
    \using \mathbf{a} \in \serviceaccount \cup \set{\error} &= \begin{cases}
      \tup{
        \sa¬codehash,
        \is{\mathbf{\sa¬storage}}{\emset},
        \is{\mathbf{\sa¬requests}}{\set{\kv{\tup{c, l}}{\sq{}}}},
        \is{\sa¬balance}{\mathbf{a}_\sa¬minbalance},
        \sa¬minaccgas,
        \sa¬minmemogas,
        \is{\mathbf{\sa¬preimages}}{\emset},
        \is{\sa¬created}{t},
        \sa¬gratis,
        \is{\sa¬lastacc}{0},
        \is{\sa¬parent}{\imX_\im¬id}
      } &\when c \ne \error \\
      \error &\otherwise
    \end{cases} \\
    \using \mathbf{s} &= \imX_\im¬self \exc \mathbf{s}_\sa¬balance = (\imX_\im¬self)_\sa¬balance - \mathbf{a}_\sa¬minbalance \\
    \tup{\execst', \registers'_7, \imX'_\im¬nextfreeid, (\imX'_\im¬state)_\ps¬accounts} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \imX_\im¬nextfreeid, (\imX_\im¬state)_\ps¬accounts} &\when c = \error \\
      \tup{\continue, \mathtt{HUH}, \imX_\im¬nextfreeid, (\imX_\im¬state)_\ps¬accounts} &\otherwhen f \ne 0 \wedge \imX_\im¬id \ne (\imX_\im¬state)_\ps¬manager \\
      \tup{\continue, \mathtt{CASH}, \imX_\im¬nextfreeid, (\imX_\im¬state)_\ps¬accounts} &\otherwhen \mathbf{s}_\sa¬balance < (\imX_\im¬self)_\sa¬minbalance \\
      \tup{\continue, \imX_\im¬nextfreeid, i^*, (\imX_\im¬state)_\ps¬accounts \cup \mathbf{d}} &\otherwise \\
      \multicolumn{2}{l}{\quad \where i^* = \text{check}(2^8 + (\imX_\im¬nextfreeid - 2^8 + 42) \bmod (2^{32} - 2^9))}\\
      \multicolumn{2}{l}{\quad \also \mathbf{d} = \set{ \kv{\imX_\im¬nextfreeid}{\mathbf{a}}, \kv{\imX_\im¬id}{\mathbf{s}} }}\\
    \end{cases} \\
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
    $\Omega_U(\gascounter, \registers, \memory, \imXY)$ \\
    \texttt{upgrade} = 19 \\
    $g = 10$
  } &
  $\begin{aligned}
    \using \sq{o, g, m} &= \registers\subrange{7}{3} \\
    \using c &= \begin{cases}
      \memory\subrange{o}{32} &\when \Nrange{o}{32} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \tup{\execst', \registers'_7, (\imX'_\im¬self)_\sa¬codehash, (\imX'_\im¬self)_\sa¬minaccgas, (\imX'_\im¬self)_\sa¬minmemogas} &\equiv \begin{cases}
      \tup{\panic, \registers_7, (\imX_\im¬self)_\sa¬codehash, (\imX_\im¬self)_\sa¬minaccgas, (\imX_\im¬self)_\sa¬minmemogas} &\when c = \error \\
      \tup{\continue, \mathtt{OK}, c, g, m} &\otherwise \\
    \end{cases}
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_T(\gascounter, \registers, \memory, \imXY)$ \\
  \texttt{transfer} = 20 \\
  $g = 10 + \registers_9 $} &
  $\begin{aligned}
    \using \sq{\dx¬dest, \dx¬amount, l, o} &= \registers\subrange{7}{4},  \\
    \using \mathbf{d} &= (\imX_\im¬state)_\ps¬accounts\\
    \using \mathbf{t} \in \defxfer \cup \set{\error} &= \begin{cases}
      \tup{
        \is{\dx¬source}{\imX_\im¬id},
        \dx¬dest,
        \dx¬amount,
        \is{\dx¬memo}{\memory\subrange{o}{\Cmemosize}},
        \is{\dx¬gas}{l}
      } &\when \Nrange{o}{\Cmemosize} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \using b &= (\imX_\im¬self)_\sa¬balance - \dx¬amount \\
    \tup{\execst', \registers'_7, \imX'_\im¬xfers, (\imX'_\im¬self)_\sa¬balance} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \imX_\im¬xfers, (\imX_\im¬self)_\sa¬balance} &\when \mathbf{t} = \error \\
      \tup{\continue, \mathtt{WHO}, \imX_\im¬xfers, (\imX_\im¬self)_\sa¬balance} &\otherwhen \dx¬dest \not \in \keys{\mathbf{d}} \\
      \tup{\continue, \mathtt{LOW}, \imX_\im¬xfers, (\imX_\im¬self)_\sa¬balance} &\otherwhen l < \mathbf{d}[\dx¬dest]_\sa¬minmemogas \\
      \tup{\continue, \mathtt{CASH}, \imX_\im¬xfers, (\imX_\im¬self)_\sa¬balance} &\otherwhen \dx¬amount < (\imX_\im¬self)_\sa¬minbalance \\
      \tup{\continue, \mathtt{OK}, \imX_\im¬xfers \append \mathbf{t}, b} &\otherwise
    \end{cases} \\
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_J(\gascounter, \registers, \memory, \imXY, t)$ \\
  \texttt{eject} = 21 \\
  $g = 10$} &
  $\begin{aligned}
    \using \sq{d, o} &= \registers_{7, 8} \\
    \using h &= \begin{cases}
      \memory\subrange{o}{32} &\when \Nrange{o}{32} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \using \mathbf{d} &= \begin{cases}
      (\imX_\im¬state)_\ps¬accounts\subb{d} &\when d \ne \imX_\im¬id \wedge d \in \keys{(\imX_\im¬state)_\ps¬accounts} \\
      \error &\otherwise \\
    \end{cases} \\
    \using l &= \max(81, \mathbf{d}_\sa¬octets) - 81 \\
    \using \mathbf{s}' &= \imX_\im¬self \exc \mathbf{s}'_\sa¬balance = (\imX_\im¬self)_\sa¬balance + \mathbf{d}_\sa¬balance \\
    \tup{\execst', \registers'_7, (\imX'_\im¬state)_\ps¬accounts} &\equiv \begin{cases}
      \tup{\panic, \registers_7, (\imX_\im¬state)_\ps¬accounts} &\when h = \error \\
      \tup{\continue, \mathtt{WHO}, (\imX_\im¬state)_\ps¬accounts} &\otherwhen \mathbf{d} = \error \vee \mathbf{d}_\sa¬codehash \ne \encode[32]{\imX_\im¬id} \\
      \tup{\continue, \mathtt{HUH}, (\imX_\im¬state)_\ps¬accounts} &\otherwhen \mathbf{d}_\sa¬items \ne 2 \vee \tup{h, l} \not\in \mathbf{d}_\sa¬requests \\
      \tup{\continue, \mathtt{OK}, (\imX_\im¬state)_\ps¬accounts \setminus \set{d} \cup \set{ \kv{\imX_\im¬id}{\mathbf{s}'} }} &\otherwhen \mathbf{d}_\sa¬requests\subb{h, l} = \sq{x, y}, y < t - \Cexpungeperiod \\
      \tup{\continue, \mathtt{HUH}, (\imX_\im¬state)_\ps¬accounts} &\otherwise \\
    \end{cases} \\
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_Q(\gascounter, \registers, \memory, \imXY)$ \\
  \texttt{query} = 22 \\
  $g = 10$} &
  $\begin{aligned}
    \using \sq{o, z} &= \registers_{7, 8} \\
    \using h &= \begin{cases}
      \memory\subrange{o}{32} &\when \Nrange{o}{32} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \using \mathbf{a} &= \begin{cases}
      (\imX_\im¬self)_\sa¬requests\subb{h, z} &\when \tup{h, z} \in \keys{(\imX_\im¬self)_\sa¬requests}\\
      \error &\otherwise\\
    \end{cases} \\
    \tup{\execst', \registers'_7, \registers'_8} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \registers_8} &\when h = \error \\
      \tup{\continue, \mathtt{NONE}, 0} &\otherwhen \mathbf{a} = \error \\
      \tup{\continue, 0, 0} &\otherwhen \mathbf{a} = \sq{} \\
      \tup{\continue, 1 + 2^{32}x, 0} &\otherwhen \mathbf{a} = \sq{x} \\
      \tup{\continue, 2 + 2^{32}x, y} &\otherwhen \mathbf{a} = \sq{x, y} \\
      \tup{\continue, 3 + 2^{32}x, y + 2^{32}z} &\otherwhen \mathbf{a} = \sq{x, y, z} \\
    \end{cases} \\
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_S(\gascounter, \registers, \memory, \imXY, t)$ \\
  \texttt{solicit} = 23 \\
  $g = 10$} &
  $\begin{aligned}
    \using \sq{o, z} &= \registers_{7, 8} \\
    \using h &= \begin{cases}
      \memory\subrange{o}{32} &\when \Nrange{o}{32} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \using \mathbf{a} &= \begin{cases}
      \imX_\im¬self \text{ except: } &\\
      \quad \mathbf{a}_\sa¬requests\subb{\tup{h, z}} = \sq{} &\when h \ne \error \wedge \tup{h, z} \not\in \keys{(\imX_\im¬self)_\sa¬requests} \\
      \quad \mathbf{a}_\sa¬requests\subb{\tup{h, z}} = (\imX_\im¬self)_\sa¬requests\subb{\tup{h, z}} \append t &\when (\imX_\im¬self)_\sa¬requests\subb{\tup{h, z}} = \sq{x, y} \\
      \error &\otherwise\\
    \end{cases} \\
    \tup{\execst', \registers'_7, \imX'_\im¬self} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \imX_\im¬self} &\when h = \error \\
      \tup{\continue, \mathtt{HUH}, \imX_\im¬self} &\otherwhen \mathbf{a} = \error \\
      \tup{\continue, \mathtt{FULL}, \imX_\im¬self} &\otherwhen \mathbf{a}_\sa¬balance < \mathbf{a}_\sa¬minbalance \\
      \tup{\continue, \mathtt{OK}, \mathbf{a}} &\otherwise \\
    \end{cases} \\
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_F(\gascounter, \registers, \memory, \imXY, t)$ \\
  \texttt{forget} = 24 \\
  $g = 10$} &
  $\begin{aligned}
    \using \sq{o, z} &= \registers_{7, 8} \\
    \using h &= \begin{cases}
      \memory\subrange{o}{32} &\when \Nrange{o}{32} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \using \mathbf{a} &= \begin{cases}
      \imX_\im¬self \text{ except:} &\\
      \quad \left.
        \begin{aligned}
          \keys{\mathbf{a}_\sa¬requests} &= \keys{(\imX_\im¬self)_\sa¬requests} \setminus \set{\tup{h, z}}\ ,\\[2pt]
          \keys{\mathbf{a}_\sa¬preimages} &= \keys{(\imX_\im¬self)_\sa¬preimages} \setminus \set{h}
        \end{aligned}
      \ \right\} &\when (\imX_\im¬self)_\sa¬requests\subb{h, z} \in \set{\sq{}, \sq{x, y}},\ y < t - \Cexpungeperiod \\
      \quad \mathbf{a}_\sa¬requests\subb{h, z} = \sq{x, t} &\when (\imX_\im¬self)_\sa¬requests\subb{h, z} = \sq{x} \\
      \quad \mathbf{a}_\sa¬requests\subb{h, z} = \sq{w, t} &\when (\imX_\im¬self)_\sa¬requests\subb{h, z} = \sq{x, y, w},\ y < t - \Cexpungeperiod \\
      \error &\otherwise\\
    \end{cases} \\
    \tup{\execst', \registers'_7, \imX'_\im¬self} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \imX_\im¬self} &\when h = \error \\
      \tup{\continue, \mathtt{HUH}, \imX_\im¬self} &\otherwhen \mathbf{a} = \error \\
      \tup{\continue, \mathtt{OK}, \mathbf{a}} &\otherwise \\
    \end{cases} \\
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_\Taurus(\gascounter, \registers, \memory, \imXY)$ \\
  \texttt{yield} = 25 \\
  $g = 10$} &
  $\begin{aligned}
    \using o &= \registers_7 \\
    \using h &= \begin{cases}
      \memory\subrange{o}{32} &\when \Nrange{o}{32} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \tup{\execst', \registers'_7, \imX'_\im¬yield} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \imX_\im¬yield} &\when h = \error \\
      \tup{\continue, \mathtt{OK}, h} &\otherwise \\
    \end{cases} \\
  \end{aligned}$\\
  \cmidrule(lr){1-1}\cmidrule(lr){2-2}
  \makecell*[l]{
  $\Omega_\Aries(\gascounter, \registers, \memory, \imXY, s)$ \\
  \texttt{provide} = 26 \\
  $g = 10$} &
  $\begin{aligned}
    \using \sq{o, z} &= \registers_{8, 9} \\
    \using \mathbf{d} &= (\imX_\im¬state)_\ps¬accounts\\
    \using s^* &= \begin{cases}
      s &\when \registers_7 = 2^{64} - 1 \\
      \registers_7 &\otherwise
    \end{cases} \\
    \using \mathbf{i} &= \begin{cases}
      \memory\subrange{o}{z} &\when \Nrange{o}{z} \subseteq \readable{\memory} \\
      \error &\otherwise
    \end{cases} \\
    \using \mathbf{a} &= \begin{cases}
      \mathbf{d}[s^*] &\when s^* \in \keys{\mathbf{d}} \\
      \none &\otherwise
    \end{cases} \\
    \tup{\execst', \registers'_7, \imX'_\im¬provisions} &\equiv \begin{cases}
      \tup{\panic, \registers_7, \imX_\im¬provisions} &\when \mathbf{i} = \error \\
      \tup{\continue, \mathtt{WHO}, \imX_\im¬provisions} &\otherwhen \mathbf{a} = \none \\
      \tup{\continue, \mathtt{HUH}, \imX_\im¬provisions} &\otherwhen \mathbf{a}_\sa¬requests[\tup{\blake{\mathbf{i}}, z}] \ne \sq{} \\
      \tup{\continue, \mathtt{HUH}, \imX_\im¬provisions} &\otherwhen \tup{s^*, \mathbf{i}} \in \imX_\im¬provisions \\
      \tup{\continue, \mathtt{OK}, \imX_\im¬provisions \cup \set{\tup{s^*, \mathbf{i}}}} &\otherwise \\
    \end{cases} \\
  \end{aligned}$\\
  \bottomrule
\end{longtable}
